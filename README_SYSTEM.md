# 声度星主持 - 教师绩效与薪资管理系统系统逻辑与规则文档

本文件详细说明了“声度星主持”管理系统的核心业务逻辑、计算规则、技术架构及数据流转方式。

---

## 1. 业务系统概览

系统主要分为四大核心板块：
1.  **数据仪表盘 (Dashboard)**：实时展示校区业绩、体验课转化、课消数据及各项 KPI 统计。
2.  **工作数据录入 (Data Entry)**：教师每月工作明细（课时、销售、邀约等）的录入与备份。
3.  **工资计算系统 (Salary Calculation)**：基于录入的工作数据，自动计算基本工资、提成、奖金及最终实发工资。
4.  **绩效考核系统 (Performance Evaluation)**：从续费、出勤、转化等 6 个维度对教师进行综合评分。

---

## 2. 核心计算逻辑

### 2.1 薪资计算规则 (Salary Rules)
薪资计算逻辑封装在 [salary-calculation.js](file:///Users/amigg/Desktop/amigg888.github.io/salary-calculation.js) 中：

-   **实发工资 (Net Pay)** = `折算基本工资` + `体验课奖金` + `课时提成` + `销售提成` + `手动调整` - `五险一金`
-   **基本工资折算**：
    -   按实际出勤天数折算：`基本工资 / 应出勤天数 * 实际出勤天数`。
-   **体验课奖金**：
    -   **邀约奖**：20 元/人（到店体验）。
    -   **转化奖**：50 元/人（报课成功，仅限教学老师）。
-   **课时提成**：
    -   **常规课**（阶梯制）：
        -   消课时数 ≤ 150：10 元/课时
        -   150 < 消课时数 ≤ 200：12 元/课时
        -   消课时数 > 200：15 元/课时
    -   **一对一**：按课消金额的 30% 计算。
-   **销售提成**（阶梯制）：
    -   总销售额 ≤ 10,000：3%
    -   10,000 < 总销售额 ≤ 30,000：5%
    -   总销售额 > 30,000：7%
-   **特殊人员逻辑**：
    -   **琪琪老师**（兼职）：按课时金额的 50% 分成，无基本工资和奖金。

### 2.2 绩效考核规则 (Performance Rules)
详见 [docs.md](file:///Users/amigg/Desktop/amigg888.github.io/docs.md)，考核权重如下：
-   续费率 (35%)
-   出勤率 (30%)
-   体验课转化率 (15%)
-   回访数 (10%)
-   宣传数量 (10%)
-   加分项 (上限 15 分)
-   **绩效系数**：总分 60-120+ 对应 0.6 至 2.0 的系数，作用于 500 元基准绩效奖（目前系统中该项默认为 0，处于手动调整状态）。

---

## 3. 技术架构与数据流转

### 3.1 技术栈
-   **前端**：Vue 3 (Composition API)、Tailwind CSS、Chart.js / ECharts。
-   **后端**：Flask (Python 3)、Flask-Session (文件系统存储)。
-   **数据存储**：
    -   **静态数据**：`preset-data.js` 等 JS 文件中定义的预设数据。
    -   **持久化数据**：`work_data/` 目录下的 JSON 文件（按月存储）。
    -   **本地缓存**：浏览器 `localStorage`（用于断网保护和快速恢复）。

### 3.2 数据流转路径
1.  **数据采集**：
    -   手动录入：通过 [data-entry.html](file:///Users/amigg/Desktop/amigg888.github.io/data-entry.html) 录入。
    -   脚本同步：运行 `sync_online_docs.py` 从外部表单同步原始明细。
2.  **数据存储**：
    -   前端录入数据时，先存入 `localStorage`，然后防抖（Debounce 1.5s）发送 POST 请求到后端 `/work-data` 接口。
    -   后端将数据写入 `work_data/data_YYYY-MM.json`。
3.  **数据读取**：
    -   页面初始化时，优先请求后端接口获取最新数据。
    -   若后端连接失败，自动降级读取 `localStorage` 或预设历史数据。

---

## 4. 系统运行规则

### 4.1 安全与权限
-   **登录验证**：通过 [server.py](file:///Users/amigg/Desktop/amigg888.github.io/server.py) 的 `/login` 接口验证，Session 有效期 7 天。
-   **凭证要求**：所有 API 请求必须携带 `credentials: 'include'` 以支持跨域 Cookie。
-   **操作日志**：所有关键操作（登录、保存、删除）均记录在 `audit_logs.json` 中。

### 4.2 环境要求
-   **后端端口**：必须运行在 `3001` 端口。
-   **跨域配置**：后端已针对开发环境（localhost:5500/8000）配置 CORS。

---

## 5. 常见维护操作
-   **月份切换**：系统通过 `selected_month` 状态统一控制各页面的数据展示范围。
-   **手动调整工资**：在工资计算页面点击“调整”列，可添加正负向金额及备注，数据实时同步至后端。
-   **历史版本**：工作数据录入支持手动保存版本，允许随时回滚到之前的快照。
